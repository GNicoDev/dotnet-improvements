# Пример использования SourceGenerator для создания SignalR клиентов

О новой фиче автоматической генерации [клиента для SignalR](https://devblogs.microsoft.com/dotnet/asp-net-core-updates-in-net-7-preview-1/#signalr-client-source-generator)

Проект в котором реализован простой чат в SignalR хабом.

### Сервер
Проект Server является непосредственно хабом для чата

### Общая библиотека
Проект Server.Contracts является разделяемым ресурсом, который предоставляет интерфейсы для доступа к методам вызова сервера IChatHubClient, а так же интерфейс IChatHubServer, предоставляющий контракты для отправки сообщений на сервер
Так же в этом проекте есть атрибуты необходимые для автоматической генерации классов клиента.

### Клиент
Клиент для чата реализован в виде консольного приложения

Для подключения клиента SignalR используется библиотека Microsoft.AspNetCore.SignalR.Client
Для релизации функционала автоматической генерации используется библиотека Microsoft.AspNetCore.SignalR.Client.SourceGenerator.
Ее обязательно подключать с дополниетльными атрибутами, как показано ниже

``` msbuild
<PackageReference Include="Microsoft.AspNetCore.SignalR.Client.SourceGenerator" Version="7.0.0-preview.7.22376.6" OutputItemType="Analyzer" ReferenceOutputAssembly="false" />
```
Так как любой генератор является анализатором.

Для реализации автоматической генерации клиента необходимо было реализовать класс HubRegistrationExtensions с partial методами ClientRegistration и ServerProxy.
Которые позволяют получать реализацию обращения и перехвата сообщений от сервера SignalR

Метод регистрации ClientRegistration заменяет нам все регистрации методов через 
``` csharp
.On("method", realize => ...)
```

Мы просто реализуем интерфейс клиента IChatHubClient, поставляемый в разделяемой библиотеке и регистрируем через

```csharp
var _clientConnection = _hubConnection.ClientRegistration<IChatHubClient>(new ChatHubHubClient(hubOpt));
```

Так же и с клентом для сервера. Нам достаточно зарегестрировать интерфейс сервера IChatHubServer через метод
```csharp
var _serverConnection = _hubConnection.ServerProxy<IChatHubServer>();
```

и при обращении к методам объекта `_serverConnection` мы может отправлять сообщения на SignalR хаб. 

### Порядок запуска

1. Собираем проекты
2. Запускаем проект Server
3. Далее либо из IDE запускаем консольный клиент, если хочется подебажить, либо из папки bin/debug(release) через консоль запускает приложение Client.Console. Вводим никнейм (на английском) и можно отправлять сообщения.

### Преймущества данного подхода

Мы получаем строготипизированные клиенты. Более того, еще и с версионированием.

Клиенты для хаба можно распространять в nuget пакетах, тем самым упрощая жизнь потребителям командам которые используют подключение к хабу.

Не нужно будет думать о названии и сигнатуре контрактов, при всех изменениях вы будете получать всегда актуальный набор.